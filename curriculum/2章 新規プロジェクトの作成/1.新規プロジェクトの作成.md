# 新規プロジェクトの作成

- 本章では新規プロジェクト（アプリケーションの管理単位）の作成とサーブレット/JSPの作成について解説します。
- サーブレット/JSPはいずれもJavaでWebアプリケーションを作成するための仕組みです。詳しくは後述します。
- EclipseではJava Webアプリケーションのプロジェクトを「動的Webプロジェクト」と呼びます。

## 1. 動的Webプロジェクトの作成
- Eclipseのメニューより、ファイル＞新規＞動的webプロジェクトを選択します。
  > Note : 一覧に「動的Webプロジェクト」が表示されない場合は、ファイル＞新規＞その他　より一覧から選択します。
- Eclipseのメニューより、ファイル＞新規＞動的webプロジェクトを選択します。
    - プロジェクト作成のウィザードが表示されます。プロジェクト名に「ChatSpaceApp」と入力する以外はデフォルトでOKです。
    - ページ下部「次へ」をクリックします。
[![Image from Gyazo](https://i.gyazo.com/aa0573c030a23ec28e3975986fc542d6.png)](https://gyazo.com/aa0573c030a23ec28e3975986fc542d6)
    - 次画面もデフォルトでOKです。次へをクリック。
[![Image from Gyazo](https://i.gyazo.com/02482f72d20bda678bc69e7b8b722c69.png)](https://gyazo.com/02482f72d20bda678bc69e7b8b722c69)    
    - 最後の画面もデフォルトでOKです。完了をクリック。
[![Image from Gyazo](https://i.gyazo.com/81c0c0c44b7dec749b950a8de4a72e2a.png)](https://gyazo.com/81c0c0c44b7dec749b950a8de4a72e2a)
    - プロジェクトエクスプローラ上に「ChatSpaceApp」プロジェクトが作成されます。  
[![Image from Gyazo](https://i.gyazo.com/443388191759c223bacc5ef570ced8c1.png)](https://gyazo.com/443388191759c223bacc5ef570ced8c1)

## 2. サーブレットとJSP
- Java Webアプリケーションの構成要素の基本となるのが「サーブレット」及び「JSP」です。
### ２.1. サーブレットとは？
- サーブレット（Java Servlet）とは、JavaをWebアプリケーションとして動かすために書かれたプログラムのことです。
- 本来Javaはコマンドラインで動かす仕組みなので、Webアプリケーション（ブラウザでアクセスするアプリケーション）として動かすためにはなんらかの仕組みが必要になります。
- サーブレットもJavaのプログラムには変わりないのですが、Eclipse上でサーブレットとして新規に作成することで、このWebアプリケーションとして動かすための各種メソッド等を簡単に作成することができます。
### 2.2. サーブレットコンテナとは？
- サーブレットを実行するための実行環境（ソフトウェア）を「サーブレットコンテナ」と呼びます。
- 今回はサーブレットコンテナとしてEclipseに同梱されている「Tomcat」を使用します。
> Note :  
> コマンドラインで動かすJavaとサーブレットの違いは以下のようなイメージになります。  
> 1. 通常の（コマンドライン）Javaの実行イメージ
[![Image from Gyazo](https://i.gyazo.com/fdd54f219e7862c7795a6c05a42db927.png)](https://gyazo.com/fdd54f219e7862c7795a6c05a42db927)
> 2. サーブレットの実行イメージ
[![Image from Gyazo](https://i.gyazo.com/4a001f94fb1188b5e7277dc2a9545bf1.png)](https://gyazo.com/4a001f94fb1188b5e7277dc2a9545bf1)
> ※ ポイントとしてはサーブレットはユーザ（ブラウザ）のHTTPリクエストをきっかけとして起動され、サーブレットコンテナが処理を行い、ユーザに結果（主にHTML）を返却する、という流れになります。この一連の処理を記載したJavaプログラムのことを「サーブレット」と呼びます。（あくまでサーブレットも単なるJavaプログラムには変わりありません。）
### 2.2. JSPとは？
- HTML内にJavaのコードを記述できる仕組みのことをJSP（Java Server Pages）と呼びます。
- 先述のサーブレットが主にバックエンド処理（計算ロジック、データベースアクセス等）を担当するのに対し、JSPはいわゆる”見た目”の部分を担当します。
- サーブレットは事前にコンパイルを行いクラスファイル（実行ファイル形式）を作成しておく必要がありますが、JSPはユーザ（ブラウザ）のアクセスに応じて、動的に実行されます。
> Note :  
> サーブレットとJSPの違いイメージ
[![Image from Gyazo](https://i.gyazo.com/81a591d9a8030845de99e7c39de7a5b9.png)](https://gyazo.com/81a591d9a8030845de99e7c39de7a5b9)

### 2.3. サーブレットの作成
- では実際にEclipse上でサーブレットの作成から実行までを行います。
- プロジェクト・エクスプローラーから「ChatSpaceApp」が選択されていることを確認し、右クリック＞新規＞サーブレット　を選択します。
- 新規サーブレットの作成ウィザードが表示されるので、「クラス名」に「TestServlet」と入力します。その他はデフォルトでOKです。「次へ」をクリックします。  
[![Image from Gyazo](https://i.gyazo.com/2aa0425d92c91424f8ee9e04669c245b.png)](https://gyazo.com/2aa0425d92c91424f8ee9e04669c245b)  
- 次画面もデフォルトでOKです。「次へ」をクリックします。  
[![Image from Gyazo](https://i.gyazo.com/ca21cc82d58d1ea601f0987481823e60.png)](https://gyazo.com/ca21cc82d58d1ea601f0987481823e60)  
- 最後の画面もデフォルトでOKです。「次へ」をクリックします。  
[![Image from Gyazo](https://i.gyazo.com/66fee940347abc91a3201718c2b79977.png)](https://gyazo.com/66fee940347abc91a3201718c2b79977)  
- プロジェクト・エクスプローラー＞ChatSpaceApp＞src＞main＞java　配下に「TestServlet」が作成されます。
[![Image from Gyazo](https://i.gyazo.com/78cae49f9fdbb5e3b3737546ab8efb7c.png)](https://gyazo.com/78cae49f9fdbb5e3b3737546ab8efb7c)  

### 2.4. JSPの作成
- 次にJSPの作成を行います。
- プロジェクト・エクスプローラーから、右クリック＞新規＞JSPファイル　を選択します。
- ファイル名に「Test.jsp」と入力する以外はデフォルトでOKです。「次へ」をクリックします。
[![Image from Gyazo](https://i.gyazo.com/9e02c2be0cfb501a16512f01cb02f9b9.png)](https://gyazo.com/9e02c2be0cfb501a16512f01cb02f9b9)  
- 次画面もデフォルトでOKです。「完了」をクリック。  
[![Image from Gyazo](https://i.gyazo.com/08694df5c00e742e176a34697d7b495d.png)](https://gyazo.com/08694df5c00e742e176a34697d7b495d)  
- プロジェクト・エクスプローラー＞ChatSpaceApp＞src＞main＞webapp　配下に「Test.jsp」が作成されます。  
[![Image from Gyazo](https://i.gyazo.com/34a0215bd8e8effc3205aac0ee922d65.png)](https://gyazo.com/34a0215bd8e8effc3205aac0ee922d65)  

## 3. 動作確認
- 次にTomcatの設定と起動を行います。
- 設定、といってもEclipse上には既に複数のバージョンのTomcatが設定されていますので、  アプリケーションをサーブレットコンテナ上に  
デプロイ（展開）するだけでOKです。
- Eclipse下部の「サーバ」タブから「Tomcat_Java17」を選択し、右クリック＞追加および除去　を選択します。
[![Image from Gyazo](https://i.gyazo.com/96c86c6b84e62cc070f4e2b5aa5e6ea2.png)](https://gyazo.com/96c86c6b84e62cc070f4e2b5aa5e6ea2)  
- 左側の「ChatSpaceApp」が選択されていることを確認し、「追加」ボタンをクリックし、「完了」をクリックします。
[![Image from Gyazo](https://i.gyazo.com/318f004ccc92050a33e3bcde43e10614.png)](https://gyazo.com/318f004ccc92050a33e3bcde43e10614)  
- 「サーバ」タブより「Tomcat_Java17」を右クリック＞「開始」をクリックします。
- 完了後、「起動済み,開始済み」になっていることを確認します。
[![Image from Gyazo](https://i.gyazo.com/b6a270748cabea2e91421c2f75f9f34a.png)](https://gyazo.com/b6a270748cabea2e91421c2f75f9f34a)  

### 3.1. サーブレットの動作確認
- ブラウザを開き、以下のURLにアクセスします。
    - http://localhost:8080/ChatSpaceApp/TestServlet
- 以下のような画面が表示されればOKです。  
[![Image from Gyazo](https://i.gyazo.com/2c85d61a28b1e96770ade289f9710305.png)](https://gyazo.com/2c85d61a28b1e96770ade289f9710305)  

- Note :  
上記の「Served at: /ChatSpaceApp」はどこから来ているのでしょうか。少しサーブレットのコードを見ていきます。

``` java:TestServlet
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		response.getWriter().append("Served at: ").append(request.getContextPath());
	}
```
- 今回は上記部分がブラウザに文字列を表示しているロジックになります。
- `doGetメソッド`の引数である `request` のオブジェクトを利用して、"Served at: "、及びコンテキストパス（現時点ではプロジェクト名と考えてOK）を表示しています。
- 試しに"Served at: "の文字列を変更して再度アクセスしてみます。変更後、ソースを保存しTomcatを「再開」してください。
- サーブレットを変更した際は必ず、Tomcatの「再開」≒サーブレットの再読み込みが必要になります。
- 修正した結果が反映されていればOKです。（例：Test　という文字列に変更）
[![Image from Gyazo](https://i.gyazo.com/79366fdb67b79fb6b364250717ae20ce.png)](https://gyazo.com/79366fdb67b79fb6b364250717ae20ce)  

### 3.2. JSPの動作確認
- 次にJSPの動作確認を行います。
- 現時点ではJSPファイルに変更を加えていないので、ブラウザには何も表示されません。そのため少しコードを書き加えます。
- 以下のように`<body>`タグの中に`<%= 1 + 1 %>`を加えます。
``` java:Test.jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<%= 1 + 1 %>
</body>
</html>
```
- ブラウザを開き、以下のURLにアクセスします。
    - http://localhost:8080/ChatSpaceApp/Test.jsp
- 以下のような画面が表示されればOKです。  
[![Image from Gyazo](https://i.gyazo.com/01734a0067beb3cb9b29749636aecd75.png)](https://gyazo.com/01734a0067beb3cb9b29749636aecd75)  
- `<% ~~~~ %>`で囲まれた部分はJavaのプログラムとして解釈されます。`<%= %>`は解釈した結果を表示するの意味になります。
- Note :  
試しにソースを修正して、結果が反映されることを確認してみます。  
以下のように`<body>`タグの中に修正を加えます。  
``` java:Test.jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<% for (int i = 0; i < 10; i++) { %>
    Hello World!（<%= i+1 %>回目）<br>
<% } %>
</body>
</html>
```
- JSPは実行時に動的に結果を算出します。そのためTomcatの「再開」は不要です。
- ソースを保存したら、ブラウザを更新します。
- 以下のような結果が表示されればOKです。  
[![Image from Gyazo](https://i.gyazo.com/53148851bcc3fbc15045f154a3d5fba3.png)](https://gyazo.com/53148851bcc3fbc15045f154a3d5fba3)  

## 4. まとめ
- この章では新規プロジェクトの作成とサーブレット、JSPについて解説しました。
- 次章から今回作成する掲示板Webアプリに必要なライブラリやソフトウェアのインストール及びデータベース周りの設定とコーディングを行います。
